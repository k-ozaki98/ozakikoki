
<div class="mv">
  <div class="l-inner mv__inner">
    <div class="mv__text">

      <svg id="name" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 414.22 69.26">
        <path class="cls cls01" d="M7.7,12.86c-.38-.88-1.11-1.49-2.21-1.83-1.1-.34-2.83-.52-5.21-.52-.13,0-.19-.19-.19-.56s.06-.56,.19-.56l4.69,.09c2.63,.13,4.72,.19,6.29,.19,1.81,0,4.04-.06,6.66-.19l4.41-.09c.19,0,.28,.19,.28,.56s-.09,.56-.28,.56c-2.32,0-4.02,.19-5.11,.56-1.1,.38-1.85,1.02-2.25,1.92-.41,.91-.61,2.3-.61,4.18V60.44c0,1.94,.19,3.35,.56,4.22,.38,.88,1.11,1.47,2.21,1.78,1.09,.31,2.83,.47,5.21,.47,.19,0,.28,.19,.28,.56s-.09,.56-.28,.56c-1.88,0-3.38-.03-4.5-.09l-6.57-.09-6.38,.09c-1.13,.06-2.69,.09-4.69,.09-.13,0-.19-.19-.19-.56s.06-.56,.19-.56c2.38,0,4.11-.16,5.21-.47,1.09-.31,1.84-.92,2.25-1.83,.41-.91,.61-2.3,.61-4.18V16.99c0-1.88-.19-3.25-.56-4.13Zm29.84-.47c0-1.25-1.85-1.88-5.54-1.88-.13,0-.19-.19-.19-.56s.06-.56,.19-.56l4.04,.09c2.5,.13,4.79,.19,6.85,.19s4.22-.06,6.48-.19l3.47-.09c.19,0,.28,.19,.28,.56s-.09,.56-.28,.56c-2.57,0-5.29,.56-8.16,1.69-2.88,1.13-5.57,2.91-8.07,5.35L12.58,41.1h-2.35l24.21-24.12c2.06-2.06,3.1-3.6,3.1-4.6Zm-20.65,23.27l4.69-3.75,13.7,17.46c4.57,5.94,8.05,10.14,10.46,12.58,2.41,2.44,4.27,3.88,5.58,4.32,1.31,.44,3.22,.66,5.72,.66,.19,0,.28,.19,.28,.56s-.09,.56-.28,.56h-10.51c-.5,0-1.39,.01-2.67,.05-1.28,.03-3.08-1.56-5.4-4.79-2.32-3.22-4.54-6.18-6.66-8.87l-14.92-18.77Z"/>
        <path class="cls cls02" d="M69.96,66.58c-2.78-1.78-4.93-4.19-6.43-7.23-1.5-3.03-2.25-6.33-2.25-9.9,0-4.07,.99-7.52,2.96-10.37,1.97-2.85,4.5-4.97,7.6-6.38,3.1-1.41,6.24-2.11,9.43-2.11,3.69,0,6.91,.91,9.67,2.72,2.75,1.82,4.86,4.21,6.33,7.18,1.47,2.97,2.21,6.12,2.21,9.43,0,3.88-.91,7.27-2.72,10.18-1.81,2.91-4.24,5.16-7.27,6.76-3.04,1.6-6.33,2.39-9.9,2.39s-6.84-.89-9.62-2.67Zm20.32-2.77c1.88-2.44,2.82-6.19,2.82-11.26,0-3.88-.64-7.35-1.92-10.42-1.28-3.06-3.05-5.46-5.3-7.18-2.25-1.72-4.82-2.58-7.7-2.58-3.38,0-5.99,1.22-7.84,3.66-1.85,2.44-2.77,5.94-2.77,10.51,0,3.82,.62,7.32,1.88,10.51,1.25,3.19,3,5.72,5.25,7.6,2.25,1.88,4.79,2.82,7.6,2.82,3.44,0,6.1-1.22,7.98-3.66Z"/>
        <path class="cls cls03" d="M105.01,67.47c0-.38,.09-.56,.28-.56,1.69,0,2.94-.17,3.75-.52,.81-.34,1.38-.97,1.69-1.88,.31-.91,.47-2.27,.47-4.08V11.92c0-2.25-.22-3.88-.66-4.88-.44-1-1.22-1.5-2.35-1.5-.94,0-2.38,.44-4.32,1.31h-.19c-.19,0-.34-.16-.47-.47-.13-.31-.06-.5,.19-.56L115.14,.09l.47-.09c.19,0,.38,.08,.56,.23,.19,.16,.28,.33,.28,.52V60.44c0,1.88,.16,3.25,.47,4.13,.31,.88,.88,1.49,1.69,1.83,.81,.34,2.06,.52,3.75,.52,.19,0,.28,.19,.28,.56s-.09,.56-.28,.56c-1.44,0-2.6-.03-3.47-.09l-5.07-.09-5.07,.09c-.88,.06-2.03,.09-3.47,.09-.19,0-.28-.19-.28-.56Zm9.38-16.23l14.64-11.82c2-1.56,3-2.94,3-4.13,0-1.56-1.78-2.35-5.35-2.35-.19,0-.28-.19-.28-.56s.09-.56,.28-.56c1.69,0,2.97,.03,3.85,.09l6.85,.09,6.29-.09c.81-.06,1.94-.09,3.38-.09,.19,0,.28,.19,.28,.56s-.09,.56-.28,.56c-2.31,0-4.88,.56-7.69,1.69-2.82,1.13-5.63,2.82-8.45,5.07l-16.14,12.67-.38-1.13Zm14.26,16.23c0-.38,.06-.56,.19-.56,3.13,0,4.69-.59,4.69-1.78,0-.56-.28-1.25-.84-2.06l-11.92-16.23,4.41-3.19,12.2,16.8c3.13,4.32,6.72,6.48,10.79,6.48,.19,0,.28,.19,.28,.56s-.09,.56-.28,.56c-1.44,0-2.6-.03-3.47-.09l-5.07-.09-6.76,.09c-1,.06-2.35,.09-4.04,.09-.13,0-.19-.19-.19-.56Z"/>
        <path class="cls cls04" d="M153.71,67.47c0-.38,.06-.56,.19-.56,1.69,0,2.96-.17,3.8-.52,.84-.34,1.42-.95,1.74-1.83,.31-.88,.47-2.25,.47-4.13v-17.55c0-2.25-.23-3.88-.7-4.88-.47-1-1.27-1.5-2.39-1.5s-2.53,.44-4.22,1.31h-.09c-.25,0-.44-.16-.56-.47-.13-.31-.09-.53,.09-.66l12.2-5.63,.38-.09c.12,0,.28,.08,.47,.23,.19,.16,.28,.33,.28,.52,0,.44-.03,1.69-.09,3.75-.06,2.06-.09,4.5-.09,7.32v17.64c0,1.88,.16,3.25,.47,4.13,.31,.88,.88,1.49,1.69,1.83,.81,.34,2.06,.52,3.75,.52,.19,0,.28,.19,.28,.56s-.09,.56-.28,.56c-1.44,0-2.6-.03-3.47-.09l-5.07-.09-5.07,.09c-.88,.06-2.06,.09-3.57,.09-.13,0-.19-.19-.19-.56Zm5.07-48.52c-.75-.69-1.13-1.66-1.13-2.91s.38-2.22,1.13-2.91c.75-.69,1.75-1.03,3-1.03s2.22,.34,2.91,1.03c.69,.69,1.03,1.66,1.03,2.91s-.34,2.22-1.03,2.91-1.66,1.03-2.91,1.03-2.25-.34-3-1.03Z"/>
        <path class="cls cls05" d="M215.32,65.08c-4.54-2.72-8.04-6.41-10.51-11.07-2.47-4.66-3.71-9.74-3.71-15.25,0-6.44,1.63-11.96,4.88-16.56,3.25-4.6,7.43-8.05,12.53-10.37,5.1-2.31,10.31-3.47,15.62-3.47,5.94,0,11.17,1.39,15.67,4.18,4.5,2.78,7.96,6.46,10.37,11.03,2.41,4.57,3.61,9.42,3.61,14.55,0,5.69-1.5,10.92-4.5,15.67-3,4.76-7.02,8.51-12.06,11.26-5.04,2.75-10.5,4.13-16.38,4.13s-11-1.36-15.53-4.08Zm30.31-.99c3.41-2.06,6.1-5.08,8.07-9.06,1.97-3.97,2.96-8.74,2.96-14.31,0-5.88-1.09-11.1-3.28-15.67-2.19-4.57-5.27-8.13-9.24-10.7-3.97-2.56-8.62-3.85-13.94-3.85-6.88,0-12.26,2.22-16.14,6.66-3.88,4.44-5.82,10.54-5.82,18.3,0,5.88,1.09,11.25,3.28,16.09,2.19,4.85,5.26,8.67,9.2,11.45,3.94,2.78,8.41,4.18,13.42,4.18,4.25,0,8.09-1.03,11.5-3.1Z"/>
        <path class="cls cls06" d="M294.38,33.03c-4.88,0-8.67,.2-11.36,.61-2.69,.41-4.8,1.21-6.33,2.39-1.53,1.19-2.64,2.97-3.33,5.35,0,.13-.13,.19-.38,.19-.19,0-.36-.05-.52-.14-.16-.09-.2-.17-.14-.23l3.19-12.11c.06-.12,.27-.17,.61-.14,.34,.03,.48,.11,.42,.23-.06,.19-.09,.44-.09,.75,0,.75,.34,1.25,1.03,1.5,.69,.25,1.88,.38,3.57,.38h19.89c.25,0,.45,.13,.61,.38,.16,.25,.2,.5,.14,.75l-22.15,33.03c-.25,.44-.09,.66,.47,.66,6.13,0,10.49-.19,13.09-.56,2.6-.38,4.49-1.17,5.68-2.39,1.19-1.22,2.25-3.33,3.19-6.33,.06-.12,.25-.19,.56-.19s.47,.06,.47,.19l-.19,9.67c0,.25-.08,.49-.23,.7-.16,.22-.36,.33-.61,.33h-29c-.25,0-.46-.12-.61-.38-.16-.25-.17-.5-.05-.75l22.52-33.22c.19-.44,.03-.66-.47-.66Z"/>
        <path class="cls cls07" d="M313.58,66.86c-1.28-1.22-1.92-2.77-1.92-4.65s.75-3.5,2.25-4.88c1.5-1.38,3.97-2.69,7.41-3.94l11.26-4.22,.28,1.22-9.95,3.85c-1.75,.69-3.02,1.49-3.8,2.39-.78,.91-1.17,1.99-1.17,3.24,0,1.5,.48,2.77,1.45,3.8,.97,1.03,2.24,1.55,3.8,1.55,1.25,0,2.75-.5,4.5-1.5l5.91-3.57,.19,1.22-6.94,4.5c-1.56,1-2.94,1.72-4.13,2.16-1.19,.44-2.44,.66-3.75,.66-2.32,0-4.11-.61-5.4-1.83Zm21.54,1.92c-.94,0-1.75-.72-2.44-2.16-.69-1.44-1.03-3.35-1.03-5.72v-17.74c0-7.01-1.97-10.51-5.91-10.51-2.13,0-3.74,.7-4.83,2.11-1.1,1.41-1.83,3.02-2.21,4.83-.25,1.19-.61,2.13-1.08,2.82-.47,.69-1.3,1.03-2.49,1.03-1,0-1.77-.28-2.3-.84-.53-.56-.8-1.22-.8-1.97,0-1.5,.97-3,2.91-4.5,1.94-1.5,4.25-2.75,6.94-3.75,2.69-1,5.1-1.5,7.23-1.5,2.56,0,4.5,.81,5.82,2.44,1.31,1.63,1.97,3.97,1.97,7.04v17.55c0,2.19,.28,3.79,.84,4.79,.56,1,1.47,1.5,2.72,1.5s2.82-.41,4.69-1.22h.19c.25,0,.41,.14,.47,.42,.06,.28-.03,.49-.28,.61l-9.67,4.6c-.25,.12-.5,.19-.75,.19Z"/>
        <path class="cls cls08" d="M347.87,67.47c0-.38,.09-.56,.28-.56,1.69,0,2.94-.17,3.75-.52,.81-.34,1.38-.97,1.69-1.88,.31-.91,.47-2.27,.47-4.08V11.92c0-2.25-.22-3.88-.66-4.88-.44-1-1.22-1.5-2.35-1.5-.94,0-2.38,.44-4.32,1.31h-.19c-.19,0-.34-.16-.47-.47-.13-.31-.06-.5,.19-.56L358.01,.09l.47-.09c.19,0,.38,.08,.56,.23,.19,.16,.28,.33,.28,.52V60.44c0,1.88,.16,3.25,.47,4.13,.31,.88,.88,1.49,1.69,1.83,.81,.34,2.06,.52,3.75,.52,.19,0,.28,.19,.28,.56s-.09,.56-.28,.56c-1.44,0-2.6-.03-3.47-.09l-5.07-.09-5.07,.09c-.88,.06-2.03,.09-3.47,.09-.19,0-.28-.19-.28-.56Zm9.38-16.23l14.64-11.82c2-1.56,3-2.94,3-4.13,0-1.56-1.78-2.35-5.35-2.35-.19,0-.28-.19-.28-.56s.09-.56,.28-.56c1.69,0,2.97,.03,3.85,.09l6.85,.09,6.29-.09c.81-.06,1.94-.09,3.38-.09,.19,0,.28,.19,.28,.56s-.09,.56-.28,.56c-2.32,0-4.88,.56-7.7,1.69-2.82,1.13-5.63,2.82-8.45,5.07l-16.14,12.67-.38-1.13Zm14.26,16.23c0-.38,.06-.56,.19-.56,3.13,0,4.69-.59,4.69-1.78,0-.56-.28-1.25-.84-2.06l-11.92-16.23,4.41-3.19,12.2,16.8c3.13,4.32,6.72,6.48,10.79,6.48,.19,0,.28,.19,.28,.56s-.09,.56-.28,.56c-1.44,0-2.6-.03-3.47-.09l-5.07-.09-6.76,.09c-1,.06-2.35,.09-4.04,.09-.13,0-.19-.19-.19-.56Z"/>
        <path class="cls cls09" d="M396.58,67.47c0-.38,.06-.56,.19-.56,1.69,0,2.96-.17,3.8-.52,.84-.34,1.42-.95,1.74-1.83,.31-.88,.47-2.25,.47-4.13v-17.55c0-2.25-.23-3.88-.7-4.88-.47-1-1.27-1.5-2.39-1.5s-2.53,.44-4.22,1.31h-.09c-.25,0-.44-.16-.56-.47-.13-.31-.09-.53,.09-.66l12.2-5.63,.38-.09c.12,0,.28,.08,.47,.23,.19,.16,.28,.33,.28,.52,0,.44-.03,1.69-.09,3.75-.06,2.06-.09,4.5-.09,7.32v17.64c0,1.88,.16,3.25,.47,4.13,.31,.88,.88,1.49,1.69,1.83,.81,.34,2.06,.52,3.75,.52,.19,0,.28,.19,.28,.56s-.09,.56-.28,.56c-1.44,0-2.6-.03-3.47-.09l-5.07-.09-5.07,.09c-.88,.06-2.06,.09-3.57,.09-.13,0-.19-.19-.19-.56Zm5.07-48.52c-.75-.69-1.13-1.66-1.13-2.91s.38-2.22,1.13-2.91c.75-.69,1.75-1.03,3-1.03s2.22,.34,2.91,1.03c.69,.69,1.03,1.66,1.03,2.91s-.34,2.22-1.03,2.91c-.69,.69-1.66,1.03-2.91,1.03s-2.25-.34-3-1.03Z"/>
      </svg>
    </div>
  </div>

</div>

<style lang="scss">
  @import '../styles/vars.scss';

  .mv {
		height: 100vh;
		width: 100%;
		position: relative;
    margin-bottom: vw-pc(100);

		&__hmbbtn {
			position: absolute;
			top: 50%;
			left: 6rem;
			transform: translate(0, -50%);
		}

		svg {
			overflow: hidden;
			position: relative;
		}

		&__text {
			position: absolute;
			top: 50%;
			left: 50%;
			transform: translate(-50%, -50%);
			width: 65%;

      @include max-screen($bp-sp) {
        width: 80%;
      }
		}

	}

  


  .content {
    z-index: 10;
    text-align: center;
    opacity: 0;
  }
</style>

<script>
  import { gsap } from "gsap";
  import { ScrollTrigger } from "gsap/ScrollTrigger";

  let animationInitialized = false;

  function initAnimation() {
    if(animationInitialized) return

    gsap.registerPlugin(ScrollTrigger);
  
    const tl = gsap.timeline();
  
    // 線が右から左に伸びるアニメーション
    tl.fromTo(".line", 
      { scaleX: 0, transformOrigin: "right center" },
      { scaleX: 1, duration: 1, ease: "power2.inOut" }
    )
    // 上下の要素が開くアニメーション
    .to(".top-half", { y: "-50vh", duration: 1, ease: "power2.inOut" }, "+=0.2")
    .to(".bottom-half", { y: "50vh", duration: 1, ease: "power2.inOut" }, "<")
    // ラインを消す
    .to(".line", { opacity: 0, duration: 0.5 }, "<")
    // .mvを表示
    .to(".mv", { opacity: 1, duration: 0.5 })
    .to("#animation-container", { display: 'none'}, ">")
    // SVGのパスアニメーション
    .fromTo('.cls', {
      opacity: 0,
      yPercent: 100,
      xPercent: 40,
      scale: 0.1,
      skewX: 50,
      skewY: 50
    }, {
      opacity: 1,
      xPercent: 0,
      yPercent: 0,
      scale: 1,
      skewX: 0,
      skewY: 0,
      duration: 0.7,
      stagger: 0.1,
      ease: 'power2.out'
    }, "-=0.5")
    .add(() => {
      const hmb01 = document.querySelector('.hmb-btn__hmb span:nth-child(1)');
      const hmb02 = document.querySelector('.hmb-btn__hmb span:nth-child(2)');
      const hmb03 = document.querySelector('.hmb-btn__hmb span:nth-child(3)');

      // ハンバーガーメニューの線を初期状態で非表示にする
      gsap.set([hmb01, hmb02, hmb03], { 
        width: '0%',
        opacity: 1
      });

      // 3本の線を順番に表示するアニメーション
      tl.to(hmb01, {
        width: '100%',
        duration: 0.3,
        ease: 'power2.out'
      }, '-=0.2') // SVGアニメーション完了と同時に開始
      tl.to(hmb02, {
        width: '100%',
        duration: 0.3,
        ease: 'power2.out'
      }, '-=0.2') // 0.2秒前のタイミングで開始
      tl.to(hmb03, {
        width: '100%',
        duration: 0.3,
        ease: 'power2.out'
      }, '-=0.2') // 0.2秒前のタイミングで開始
    })
    .add(() => {
      const svg = document.querySelector('.mv svg');
      svg.style.overflow = 'visible';
  
      const animations = [
        { selector: ".cls01", y: -200 },
        { selector: ".cls02", y: 60 },
        { selector: ".cls03", y: 0 },
        { selector: ".cls04", y: -80 },
        { selector: ".cls05", y: -170 },
        { selector: ".cls06", y: -50 },
        { selector: ".cls07", y: -120 },
        { selector: ".cls08", y: 40 },
        { selector: ".cls09", y: -150 },
      ];
  
      animations.forEach(anim => {
        gsap.to(anim.selector, {
          yPercent: anim.y,
          ease: "none",
          scrollTrigger: {
            trigger: ".mv",
            start: "top top",
            end: "bottom top",
            scrub: 1
          }
        });
      });
    });
    animationInitialized = true;
  }

  // function resetAnimation() {
  //   gsap.set([".line", ".top-half", ".bottom-half", ".mv", "#animation-container", ".cls"], { clearProps: "all" });
  //   ScrollTrigger.getAll().forEach(st => st.kill());
  //   animationInitialized = false;
  // }

  function handlePageShow(event) {
    if (event.persisted) {
      // ページがブラウザのキャッシュから復元された場合（ブラウザバック等）
      // resetAnimation();
      initAnimation();
    }
  }

  window.addEventListener('pageshow', handlePageShow);

  window.addEventListener('load', () => {
    initAnimation();
  });

  window.addEventListener('pageshow', function(event) {
    if (event.persisted) {
      initAnimation();
    }
});

  // Astro の View Transitions を使用している場合、以下のイベントリスナーを追加
  document.addEventListener('astro:after-swap', () => {
    // resetAnimation();
    initAnimation();
  });
</script>